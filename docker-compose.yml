version: '2'
services:
  afrostreampostgres:
    environment:
     - POSTGRES_PASSWORD=postgres
    volumes:
     - ./data/postgresql:/var/lib/postgresql/data
    build: ./afrostream-postgres
  rabbitmq:
    environment:
     - RABBITMQ_DEFAULT_USER=rabbitmq
     - RABBITMQ_DEFAULT_PASS=rabbitmq
    image: rabbitmq:3-management
    ports:
     - "5603:15672"
  afrostreamapiv1:
    environment:
     - AFROSTREAM_API_KEY=8c261045-89a3-44bb-af38-65a847269605
     - AFROSTREAM_API_SECRET=3dc3cae6-9c79-487a-9e0f-712be857dcee
     - ALLOW_URL=*
     - API_CLIENT_END_POINT=http://afrostreambackend/api
     - AUTH0_CALLBACK_URL=afrostream-api-v1.herokuapp.com/callback
     - AUTH0_CLIENT_ID=BtSdIqKqfIse0H1dqlpHFJgKIkUG0NpE
     - AUTH0_DOMAIN=afrostream.eu.auth0.com
     - AUTH0_SECRET=KYmL01KW5HczO-XKpltlVUONRCXtynJQ0nFqiGNOsjN9c3RsBAnr5_T-rnnc7DYY
     - KEY_METRICS_PRIVATE_KEY=qigcd3tiue2el5k
     - KEY_METRICS_PUBLIC_KEY=ns4xyu6prfqcarv
     - MONGOLAB_URI=mongodb://heroku_nd0hbtmt:k556bnvhqfc7fbiamm5ub4g7qu@ds047712.mongolab.com:47712/heroku_nd0hbtmt
     - NODE_ENV=development
     - RECURLY_API_KEY=67dbb29f0dbe4e219bc247a3b5387652
     - RECURLY_SUB_DOMAIN=johnarch
     - SESSION_SECRET=afrostream-secret
     - WEB_MACHINE_NAME=heroku
     - IP=0.0.0.0
     - PORT=5601
    build: ./afrostream-api-v1
    ports:
      - "5601:5601"
    volumes:
      - ./src/afrostream-api-v1:/usr/src/app
    depends_on:
      - afrostreambackend
    links:
      - afrostreambackend
  afrostreambackend:
    environment:
      - ALGOLIA_API_KEY=47d48040a13e973aca2ea9f492eca17e
      - ALGOLIA_APP_ID=3OKNPL7ZVA
      - AWS_ACCESS_KEY_ID=AKIAIJ7BEEEIYX3CZDOQ
      - AWS_SECRET_ACCESS_KEY=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
      - CLOUDAMQP_URL=amqp://rabbitmq:rabbitmq@rabbitmq/
      - DATABASE_URL=postgres://postgres:postgres@afrostreampostgres/postgres
      - DIGIBOS_DOMAIN=http://mam.afrostream.tv:3000/api/contents
      - DIGIBOS_PROXY=http://origin.afrostream.tv
      - DIGIBOS_TOKEN=false
      - FACEBOOK_CALLBACK_DOMAIN=https://afrostream.tv
      - FACEBOOK_ID=828887693868980
      - FACEBOOK_SECRET=25130290468ec21fbefd1604218cc57c
      - GRAPHENEDB_URL=http://app39710506-KSSG0x:zU6HMofF9KLiz6FZPbvo@app39710506kssg0x.sb04.stations.graphenedb.com:24789
      - IMGIX_DOMAIN=https://afrostream.imgix.net
      - MONGOLAB_URI=mongodb://heroku_wsgfcwfr:l12bet6hdb39mcvb6vklp9vg3s@ds037581.mongolab.com:37581/heroku_wsgfcwfr
      - NODE_ENV=development
      - RECURLY_API_KEY=82e5ec329c384b4995b979cc63536796
      - RECURLY_SUB_DOMAIN=afrostream
      - S3_BUCKET_NAME=afrostream-img
      - SEND_GRID_API_KEY=Afr@stream77
      - SEND_GRID_CLIENT_ID=azure_3e7c4f32e08f4c0ba3c3ec8eb6c2fe58@azure.com
      - USER_TOKEN_EXPIRE=86400
      - VIDEO_TOKEN_EXPIRE=300
      - IP=0.0.0.0
      - PORT=5602
    build: ./afrostream-back-end
    ports:
      - "5602:5602"
    volumes:
      - ./src/afrostream-back-end:/usr/src/app
    depends_on:
      - afrostreampostgres
      - rabbitmq
    links:
      - afrostreampostgres
      - rabbitmq
  afrostreamfrontend:
    environment:
      - ALGOLIA_API_KEY=3e6547172fb6d80b2ae02d6369edfc72
      - ALGOLIA_APP_ID=3OKNPL7ZVA
      - API_CLIENT_AUTHORITY=api.afrostream.tv
      - API_CLIENT_END_POINT=http://localhost:5601/
      - API_CLIENT_PROTOCOL=http
      - API_END_POINT=http://localhost:5602/
      - API_IMAGES_AUTHORITY=images.cdn.afrostream.net
      - API_IMAGES_END_POINT=https://images.cdn.afrostream.net
      - API_IMAGES_PROTOCOL=https
      - BITLY_ACCESS_TOKEN=3f7014f52dd257e8e502a3682835721020713736
      - BITLY_API_KEY=R_8199c11a3938481aa8fdd538530b9137
      - BITLY_CLIENT_ID=6919ad7c69fc680e8c1746e329ce06ebf4528640
      - BRAINTREE_PUBLIC_KEY=production_f4y3q99v_x6hsrp62xgzbfj98
      - CHROMECAST_ID=
      - DOMAIN_HOST=afrostream.tv
      - FB_TRACKING_ID=914487875264661
      - GA_TRACKING_ID=UA-47871575-1
      - GOCARDLESS_PUBLIC_KEY=CYgpKfDiPnYMvQ5BFGE_3s2IHIaSbSzQ4Tmg2Vsl
      - GOOGLE_ANALYTICS=UA-47871575-1
      - LIBRATO_PASSWORD=89e73b2f58f85ff7
      - LIBRATO_TOKEN=b0b6ff7d039d0576ac3237ed63947292e3025bb942bdddb0f788f6a56023c1ce
      - LIBRATO_USER=app38190314@heroku.com
      - OAUTH_BOUYGUES_ENABLED=true
      - OAUTH_FACEBOOK_ENABLED=true
      - OAUTH_ORANGE_ENABLED=true
      - RECURLY_PUBLIC_KEY=sjc-WOBbERhzqRX5AJ6hVGOPzv
      - SENDBIRD_API_TOKEN=3915d25ef28e538be42206f17ff7345bb7e6a6cb
      - SENDBIRD_APP_ID=BEACEB74-4847-4DB1-94F2-F0F04688392A
      - SENTRY_DSN=https://24502de12b75437cb3783c395bd466f0:0d9f657cbc81459ba70c0ad132536a2d@app.getsentry.com/59853
      - SPONSORSHIP_BILLING_UUID=d9e879c7-e445-409f-ad44-817e30e62fc0
      - STRIPE_PUBLIC_KEY=pk_test_s9YFHvFFIjo2gdAL5x4k2ISh
      - YOUBORA_ID=afrostream
      - NODE_ENV=development
      - WPHOST=0.0.0.0
      - WPPORT=5604
      - IP=0.0.0.0
      - PORT=5600
    ports:
      - "5600:5600"
      - "5604:5604"
    volumes:
      - ./src/afrostream-front-end:/usr/src/app
    build: ./afrostream-front-end
    links:
      - afrostreamapiv1
  afrostreambillings:
    environment:
      - AFR_DB_HOST=ec2-54-228-194-210.eu-west-1.compute.amazonaws.com
      - AFR_DB_NAME=d71on7act83b7i
      - AFR_DB_PASSWORD=pt7eht3e9v3lnehhh27m7sfeol
      - AFR_DB_PORT=5522
      - AFR_DB_USER=u4fp4ad34q8qvi
      - API_HTTP_AUTH_PWD=billingsapirocks
      - API_HTTP_AUTH_USER=admin
      - API_HTTP_SECURE=false"
      - BILLINGS_API_HTTP_AUTH_PWD=billingsapirocks
      - BILLINGS_API_HTTP_AUTH_USER=admin
      - BILLINGS_API_URL=https://afrostream-billings-staging.herokuapp.com
      - BOUYGUES_STORE_TIME_HOUR=0
      - BOUYGUES_STORE_TIME_MINUTE=5
      - DATABASE_URL=postgres://postgres:postgres@afrostreambillingspostgres/postgres
      - EVENT_EMAIL_ACTIVATED=true
      - GOCARDLESS_API_ENV=sandbox
      - GOCARDLESS_API_KEY=YXwxcLeTGwGv3sPd1-CpmNh3nAsqtDfzGuV8_Vji
      - GOCARDLESS_WH_SECRET=gocardlessrocks
      - RECURLY_API_KEY=67dbb29f0dbe4e219bc247a3b5387652
      - RECURLY_API_SUBDOMAIN=johnarch
      - RECURLY_WH_HTTP_AUTH_PWD=recurlyrocks
      - RECURLY_WH_HTTP_AUTH_USER=admin
      - SENDGRID_PASSWORD=mdaf58gf2829
      - SENDGRID_USERNAME=app41486990@heroku.com
      - SENDGRID_TEMPLATE_SUBSCRIPTION_NEW_ID=dde84299-e6fe-47a0-909b-1ee11417efe1
      - SENDGRID_TEMPLATE_SUBSCRIPTION_CANCEL_ID=32685665-87ba-4c67-a726-395b58c2e36b
      - SENDGRID_FROM=abonnement@afrostream.tv
      - SENDGRID_FROM_NAME=Tonj√©\, Fondateur d'Afrostream
      - BOUYGUES_MERCHANTID=0
      - BOUYGUES_SERVICEID=0
      - BOUYGUES_PROXY_HOST=localhost
      - BOUYGUES_PROXY_PORT=8080
      - BOUYGUES_PROXY_USER=user
      - BOUYGUES_PROXY_PWD=pwd
      - SLACK_ACTIVATED=1
      - SLACK_GROWTH_CHANNEL=growth
      - SLACK_STATS_CHANNEL=stats
      - SLACK_STATS_COUPONS_CHANNEL=activation
    ports:
      - "5605:80"   
    volumes:
      - ./src/afrostream-billings:/app
    build: ./afrostream-billings
    depends_on:
      - afrostreambillingspostgres
    links:
      - afrostreambillingspostgres
  afrostreambillingspostgres:
    environment:
     - POSTGRES_PASSWORD=postgres
    volumes:
     - ./data/billingspostgresql:/var/lib/postgresql/data
    build: ./afrostream-billings-postgres
